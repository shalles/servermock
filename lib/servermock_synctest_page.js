/**
 * servermock synctest plugin 多平台同步测试：实现操作一个平台多个平台同步事件操作
 * version 1.0.1
 * @param  {[type]} synctest_origin server synctest监听的websocket源 默认"127.0.0.1:80"
 */
function synctest__(synctest_origin){
!function(a){function h(a){return"function"==typeof a}function i(a){this.list=[]}function j(a){return Object.prototype.toString.call(a).slice(8,-1)}function k(){function b(c,d,e){for(var f in d){var h=d[f];if(e){var i=j(h),k="Array"===i,m="Object"===i||l(i,["Touch","TouchList"]);if(k||m){var n=j(c[f]);k?"Array"!==n&&(c[f]=[]):"Object"!==n&&(c[f]={}),a.watch(h,function(){b(c[f],h,e)})}else g(h,f)&&(c[f]=h)}else g(h,f)&&(c[f]=h)}}var c,e,g,a={stack:[],reset:function(){stack=[]},watch:function(a,b){this.stack.indexOf(a)>-1||(this.stack.push(a),b())}},d=arguments.length,f=0;for(e=arguments[f]===!0?(f++,!0):!1,c=arguments[f++],g="function"==typeof arguments[--d]?arguments[d]:(d++,function(a){return void 0!==a}),f;d>f;f++)try{b(c,arguments[f],e)}catch(h){}return c}function l(a,b){return b.indexOf(a)>-1}function m(a,b){for(var c in b)if(l(a.ele,b[c].ele)&&l(a.type,b[c].type))return!0;return!1}function n(b){function d(b){if(!b)return c;if(b===a)c.push("window");else if(b===a.document)c.push("document");else if(b===document.body)c.push("body");else{if(b.id)return c.push("#"+b.id),c;b.classList&&b.classList.length?c.push("."+b.classList.toString().split(" ").join(".")):c.push(b.tagName),d(b.parentElement)}}var c=[];return d(b),c.reverse().join(">")}function o(a,b,c){var d,e;return b=b>c?b:c,function(){var f=this,g=new Date,h=arguments;clearTimeout(d),e||(e=g),g-e>=c?(a.apply(f,h),e=g):d=setTimeout(function(){a.apply(f,h)},b)}}function q(c){c=JSON.parse(c);var f,g,i=c.selector;if(m({ele:i,type:c.type},e))return{};switch(f="window"===i?a:"document"===i?document:document.querySelector(i),g=b[f[d]][c.type],c.type){case"input":f.value=c.value;break;case"focus":f.focus();break;case"scroll":f.scrollTop?(f.scrollTop=c.scrollTop,f.scrollLeft=c.scrollLeft):a.scrollTo(c.scrollLeft,c.scrollTop);break;case"click":f.tagName&&"a"===f.tagName.toLowerCase()&&-1===f.href.indexOf("javascript")&&(location.href=f.href)}switch(f.tagName&&f.tagName.toLowerCase()){case"input":f.value=c.value}if(c.type.indexOf("touch")>-1){var j=c.event.changedTouches;j&&(j.item=function(a){return j[a]},c.event.targetTouches=c.event.touches=j)}return{event:c.event,type:c.type,ele:f,listeners:g}}function r(b,c){function g(b,d){if(b instanceof Node||b===a)/[0-9]/.test(d)||f.dom.push({name:d,selector:n(c[d])});else if("function"!=typeof b&&!/[A-Z]/.test(d[0]))return!0;return!1}var d=b,e=n(d),f={selector:e,type:c.type};switch(c.type){case"input":f.value=d.value;break;case"scroll":f.scrollTop=d.scrollTop||scrollY,f.scrollLeft=d.scrollLeft||scrollX}return f.event={},f.dom=[],k(!0,f.event,c,g),JSON.stringify(f)}function s(a){""!==a&&1===g.readyState&&g.send(a)}function t(a){var b,c,d,e;(b=a.ele)&&(c="__synctest_event",d=new Event(c),e=function(b){k(b,a.event),b.preventDefault(),a.listeners&&a.listeners.fire(b)},u.call(b,c,e),b.dispatchEvent(d),b.removeEventListener(c,e))}function v(a,b){a.addEventListener(b,function(a){},!1)}function w(a,b){for(var c=0,d=a.length;d>c;c++)v(a[c],b)}function x(a,b){for(var c=0,d=b.length;d>c;c++)v(a,b[c])}function y(a,b){for(var c=0,d=a.length;d>c;c++)x(a[c],b)}function z(){x(a,["scroll","resize"]);var b=document.querySelectorAll("a");b.length&&w(b,"click");var c=document.querySelectorAll("input"),d=document.querySelectorAll("textarea");c.length&&y(c,["input","focus"]),d.length&&y(d,["input","focus"])}a.__synctest={};var b={},c=0,d="synccommand_"+(new Date).getTime(),e=[{ele:["window","document"],type:["DOMContentLoaded","load"]}],f="ws://{{ origin }}",g=new WebSocket(f);g.onopen=function(a){z()},g.onclose=function(a){},g.onmessage=function(a){t(q(a.data))},g.onerror=function(a){},i.prototype={add:function(a){if(h(a))this.list.push(a);else if("[object Array]"===Object.prototype.toString.call(a))for(var b=0,c=a.length;c>b;b++)arguments.callee.call(this,a[b]);return this},fireWith:function(a,b){for(var c=this.list,d=0;d<c.length;d++)c[d].apply(a,b.slice?b.slice():b);return this},fire:function(){return this.fireWith(this,arguments),this}};var p=o(function(a,b){s(r(a,b))},150,200),u=EventTarget.prototype.addEventListener;a.addEventListener=EventTarget.prototype.addEventListener=function(a,e,f){var g=this;g[d]||(g[d]=++c),((b[c]||(b[c]={}))[a]||(b[c][a]=new i)).add(function(a){e.call(g,a)});var h=function(a){try{"scroll2"===a.type?p(this,a):s(r(this,a))}catch(b){}e.call(this,a)};u.call(g,a,h,f)}}(window);rguments),this}};var p=o(function(a,b){s(r(a,b))},150,200),u=EventTarget.prototype.addEventListener;a.addEventListener=EventTarget.prototype.addEventListener=function(a,e,f){var g=this;g[d]||(g[d]=++c),((b[c]||(b[c]={}))[a]||(b[c][a]=new i)).add(function(a){e.call(g,a)});var h=function(a){try{"scroll2"===a.type?p(this,a):s(r(this,a))}catch(b){console.log(b)}e.call(this,a)};u.call(g,a,h,f)}}(window);
}